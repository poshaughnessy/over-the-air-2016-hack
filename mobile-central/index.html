<!DOCTYPE html>
<html>
  <head>
    <title>Web Bluetooth Remote</title>
  </head>
  <body>
    <h1>Web Bluetooth Remote</h1>
    <button id="btn-connect">Connect</button>
    <button id="btn-left">Left</button>
    <button id="btn-right">Right</button>
    <script>

      //var serviceUuid = '13333333-3333-3333-3333-333333333337';
      //var serviceUuid = 'd0611e78-bbb4-4591-a5f8-487910ae4366';
      //var serviceUuid = '03b80e5a-ede8-4b33-a751-6ce34ec4c700';
      var serviceUuid = 0x180E;
      //var charUuid = '13333333-3333-3333-3333-333333330001';
      var charUuid = 0x2A19;
      var characteristic;

      function connect() {

        navigator.bluetooth.requestDevice({
            filters: [{ services: [serviceUuid] }]
          })
          .then(function(device) {
            console.log('Device', device.name);
            return device.gatt.connect();
          })
          .then(function(server) {
            console.log('Server', server);
            return server.getPrimaryService(serviceUuid);
          })
          .then(function(service) {
            console.log('Service', service);
            return service.getCharacteristic(charUuid);
          })
          .then(function(char) {
            console.log('Characteristic', char);
            characteristic = char;
          });

      }

      function write(cmd) {
        //characteristic.writeValue(cmd);
        // switched to reading for testing
        return characteristic.readValue()
          .then(function(value) {
            var batteryLevel = value.getUint8(0);
            console.log('Battery level', batteryLevel);
          });
      }

      function left() {
        var cmd = new Uint8Array(1);
        cmd[0] = 1;
        write(cmd);
      }

      function right() {
        var cmd = new Uint8Array(1);
        cmd[0] = 2;
        write(cmd);
      }

      var btnConnect = document.getElementById('btn-connect');
      var btnLeft = document.getElementById('btn-left');
      var btnRight = document.getElementById('btn-right');

      btnConnect.addEventListener('click', connect, false);
      btnLeft.addEventListener('click', left, false);
      btnRight.addEventListener('click', right, false);
    </script>
  </body>
</html>
